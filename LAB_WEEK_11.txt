Aryabell Boston Tjugito
00000104031
Assignment Week 11 - Mobile Application Programming LAB (IF570-DL) 

1. When a user takes a picture, that picture is stored in a path based on the given URI. In which part of the code handles this? (Copy that part of the code as the answer)
Answer :
The picture is stored in MediaStore inside ProviderFileManager.insertToStore(), which is triggered by takePictureLauncher after the camera finishes taking the photo.
The exact code from the module (the part that handles storing the file) :
private fun insertToStore(fileInfo: FileInfo, contentUri: Uri, contentValues: ContentValues) {
    executor.execute {
        val insertedUri = contentResolver.insert(contentUri, contentValues)
        insertedUri?.let {
            val inputStream = contentResolver.openInputStream(fileInfo.uri)
            val outputStream = contentResolver.openOutputStream(insertedUri)
            IOUtils.copy(inputStream, outputStream)
        }
    }
}

The line that triggers this after taking a picture :
takePictureLauncher =
    registerForActivityResult(ActivityResultContracts.TakePicture()) {
        providerFileManager.insertImageToStore(photoInfo)
    }

2. In your FileInfo.kt, there are 5 attributes. On the first attribute, what does the URI refer to? And on the fourth attribute, what does relativePath refer to? 
Answer :
The FileInfo.kt data model :
data class FileInfo(
   val uri: Uri,
   val file: File,
   val name: String,
   val relativePath:String,
   val mimeType:String
)

On the first attribute, URI refers to a temporary FileProvider URI used by the Camera app to write the photo/video to your app’s private storage.
It is generated by :
FileProvider.getUriForFile(context, "com.example.lab_week_11_b.camera", file)

On the fourth attribute, relativePath refers to the folder inside MediaStore where the file will be stored, for example :
- Environment.DIRECTORY_PICTURES → “Pictures/”
- Environment.DIRECTORY_MOVIES → “Movies/”
MediaStore uses this to decide where to place the final copied image/video.

3. [Bonus] Explain the chronological order from when a user takes a picture until the file is stored in the MediaStore.
Answer :
Step 1 - User taps “Photo” button 
photo_button -> calls :
openImageCapture()
Which generates :
- a unique filename
- a File object
- a FileProvider URI
photoInfo = providerFileManager.generatePhotoUri(System.currentTimeMillis())

Step 2 - Camera is launched with the FileProvider URI
takePictureLauncher.launch(photoInfo?.uri)
Camera app receives the URI and writes the image into the temporary file.

Step 3 - Camera finishes capturing
The launcher callback fires:
providerFileManager.insertImageToStore(photoInfo)

Step 4 - File is copied into MediaStore
Inside insertToStore() :
1. MediaStore creates a new empty location using :
contentResolver.insert(contentUri, contentValues)
2. The temporary file is read using :
contentResolver.openInputStream(fileInfo.uri)
3. The file is written into MediaStore using :
contentResolver.openOutputStream(insertedUri)
4. IOUtils.copy() copies the bytes.

Step 5 - Final result
The image is now stored in :
- Android 10+ (Q and above) :
/storage/emulated/0/Pictures/
- Android 9 and below :
Written using legacy external storage rules.

The photo will then appear in the device’s Gallery app.